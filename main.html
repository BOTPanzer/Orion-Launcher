<!doctype html>
<html lang="en">
<head>
<title>Oriøn: Launcher</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=0">
</head>

<style>
  @font-face { font-family: BodyFont; src: url('Data/Fonts/font_body.ttf'); } 
  @font-face { font-family: ItemFont; src: url('Data/Fonts/font_item.ttf'); } 
  
  html {
    height: 100%;
    width: 100%;
    scroll-behavior: smooth;
  }
  
  body {
    background: #000000;
    font-family: BodyFont;
    overflow:hidden;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  
    --buttonColor: #000000;
    --topColor: #000000;
    --lineColor: #000000;
    --scrollColor: #000000;
    --boxColor: #000000;
    --boxBorderColor: #000000;
    --placeholderColor: #000000;
    --textColor: #000000;
    --text2Color: #000000;
    --round: 0px;
    --size1: 150px;
  }
  
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }	

  ::-webkit-scrollbar-track {
    background: var(--topColor);
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--scrollColor);
    border: solid 2px var(--topColor);
    border-radius: 5px;
  }

  ::-webkit-scrollbar-thumb:hover {
    border: solid 0px var(--topColor);
  }

  ::placeholder {
    color: var(--placeholderColor);
  }

  .sbutton {
    transition: transform .3s, background-image .1s ease-in-out;
    display: flex; 
    justify-content: center; 
    align-items: center;
    font-family: ItemFont;
    color: var(--textColor);
  }

  .sbutton:hover {
    transform: translateY(-2px);
  }
</style>

<div id="themeDiv" style="height: 0; width: 0;"></div>

<div id="wall" style="position: absolute; display: block; height: 100%; width: 100%; margin-top: 20px; display: none; z-index: 999; scroll-behavior: unset;"></div>

<body style="height: 100%; width: 100%; margin: 0px; padding: 0px;">
  <div style="height: 20px; width: 100%; display: flex; background-color: var(--topColor);">
    <div style="height: 15px; width: 100%; margin-left: 5px; margin-top: 5px; -webkit-app-region: drag;"></div>
    <div style="display: flex; font-family: Franklin Gothic Medium">
      <div style="display: flex; align-items: center;">
        <div id="mini" style="height: 20px; width: 30px; color: var(--buttonColor2); text-align: center; align-items: center; background-color: rgba(0, 0, 0, 0);">–</div>
        <div id="maxi" style="height: 20px; width: 30px; color: var(--buttonColor2); text-align: center; align-items: center; background-color: rgba(0, 0, 0, 0);">o</div>
        <div id="exit" style="height: 20px; width: 30px; color: var(--buttonColor2); text-align: center; align-items: center; background-color: rgba(0, 0, 0, 0);">x</div>
      </div>
    </div>
  </div>
  
  <div style="height: calc(100% - 20px); width: 100%; display: flex; position: relative;">
    <div id="leftBar" style="height: 100%; min-width: 155px; width: 155px; max-width: 155px; overflow: hidden; position: relative; z-index: 404; opacity: 0;">
      <div style="display: flex; align-items: center; margin: 10px;">
        <img id="orionLogo" class="sbutton" style="min-height: 50px; max-height: 50px; min-width: 50px; max-width: 50px; -webkit-user-drag: none;" src="./Data/Images/icon.png"/>
        <div id="orionName" style="margin-left: 5px; font-family: ItemFont; color: var(--text2Color);">Oriøn Launcher</div>
      </div>
      
      <div style="height: calc(100% - 70px); display: flex; flex-flow: column; flex: 1 1 auto; overflow-y: auto;">
        <div id="moduleButtons" style="flex: 1 1 auto;"></div>

        <div id="add" style="display: none; flex: 0 1 auto;">
          <div id="addfolder" class="sbutton" style="height: 36px; width: 107px; background-image: url('./Data/Images/icon_description_launch.png'); margin-bottom: 20px; margin-left: auto; margin-right: auto;">Add Folder</div>
          <div id="addgame" class="sbutton" style="height: 36px; width: 107px; background-image: url('./Data/Images/icon_description_launch.png'); margin-bottom: 20px; margin-left: auto; margin-right: auto;">Add Game</div>
        </div>
      </div>
    </div>

    <div id="line" style="width: 2px; margin-top: 5px; margin-bottom: 5px; background-color: var(--lineColor); opacity: 0.5;"></div>

    <div id="rightBar" style="width: 100%; overflow-y: scroll; z-index: 0;">
      <img id="logo" style="height: 120px; margin: 20px; -webkit-user-drag: none;" src="./Data/Images/logo.png"/> 
      <div id="window"></div>
      <div id="start" style="display: none;"></div>
    </div>
    
    <div id="noti" style="height: 70px; width: 200px; position: fixed; bottom: 20px; right: 20px; font-family: ItemFont; background-color: var(--boxColor); border-style: solid; border-color: var(--boxBorderColor); border-width: 1px; border-radius: var(--round); pointer-events: none; opacity: 0; display: flex; justify-content: space-between; flex-direction: column;">
      <div></div>
      <div id="notiTitle" style="margin-left: 10px; font-size: 17px; color: var(--text2Color);">Launching:</div>
      <div id="notiName" style="width: 160px; margin-left: 20px; font-size: 17px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: var(--textColor);">Game</div>
      <div></div>
    </div>
  </div>
</body>

<script>
  const { app, ipcRenderer, shell } = require('electron');
  window.$ = window.jQuery = require('jquery');
  const fs = require('fs');

  //DATA
  let data = {} //root, data, modules (folder paths)
  let json = null
  let loading = false
  let currentModule = ''
  //NOTI
  let showingNoti = false
  let notis = []
  let notisTitle = []

  a()
  setbuttons()

  function a() {
    ipcRenderer.on('theme', (event) => {
      $("#themeDiv").load('Data\\themeSettings.html')
    })

    ipcRenderer.on('data', (event, argData) => {
      data = argData
      json = getData()

      //ADD MODULES
      if (!fs.existsSync(data.modules)) return
      document.getElementById('moduleButtons').innerHTML = ''
      let modulestmp = fs.readdirSync(data.modules);
      let modules = []
      if (modulestmp.includes('Store')) {
        modules.push('Store')
        modulestmp.splice(modulestmp.indexOf('Store'), 1);
      } if (modulestmp.includes('Launcher')) {
        modules.push('Launcher')
        modulestmp.splice(modulestmp.indexOf('Launcher'), 1);
      } if (modulestmp.includes('Themes')) {
        modules.push('Themes')
        modulestmp.splice(modulestmp.indexOf('Themes'), 1);
      } if (modulestmp.includes('Installer')) {
        modules.push('Installer')
        modulestmp.splice(modulestmp.indexOf('Installer'), 1);
      } if (modulestmp.includes('Connect')) {
        modules.push('Connect')
        modulestmp.splice(modulestmp.indexOf('Connect'), 1);
      }
      for(i in modulestmp) { modules.push(modulestmp[i]) }
      for(i in modules) {
        //DATA
        let id = 'module'+i
        let name = modules[i]
        let path = data.modules+name
        let html = `<div id="${id}" class="sbutton" style="height: 36px; width: 107px; background-image: url('./Data/Images/icon_description_launch.png'); margin-bottom: 20px; margin-left: auto; margin-right: auto; margin-top: 10px;">
                      ${name}
                      <div id="${'path-'+id}" style="display: none;">${path}</div>
                    </div>`
        //ADD MODULE
        document.getElementById('moduleButtons').insertAdjacentHTML('beforeend', html)
        //LOAD MODULE START.HTML
        let startHTML = path+'\\start.html'
        if (fs.existsSync(startHTML)) {
          $("#start").load(startHTML.replaceAll(' ', '%20'), function () {})
        }
      }
      updateModules()

      //ORION BUTTON
      if (json.leftbar && document.getElementById('orionName').style.display == 'none')
        document.getElementById('orionLogo').click()
      else if (!json.leftbar && document.getElementById('orionName').style.display != 'none')
        document.getElementById('orionLogo').click()
      document.getElementById('leftBar').style.opacity = '1'
    })

    ipcRenderer.on('loadModule', (event, path, specialData) => {
      loadModule(path, specialData)
    })

    ipcRenderer.on('pause', (event) => {
      document.getElementById('wall').style.display = 'block'
    })

    ipcRenderer.on('resume', (event) => {
      document.getElementById('wall').style.display = 'none'
    })
  }

  function setbuttons() {
    $(window).unbind()
    $('*').unbind()

    //ORIONLOGO
    addButtonListener('orionLogo', function() {}, function() {}, function() {
      if (document.getElementById('orionName').style.display != 'none') {
        document.getElementById('leftBar').style.width = '72px'
        document.getElementById('leftBar').style.height = '70px'
        document.getElementById('leftBar').style.position = 'fixed'

        document.getElementById('orionName').style.display = 'none'
        document.getElementById('add').style.display = 'none'
        document.getElementById('line').style.opacity = '0'

        document.getElementById('logo').style.marginLeft = '72px'

        let json = getData()
        json.leftbar = false
        updateData(json)
      } else {
        document.getElementById('leftBar').style.width = '155px'
        document.getElementById('leftBar').style.height = '100%'
        document.getElementById('leftBar').style.position = 'relative'

        document.getElementById('orionName').style.display = 'flex'
        if (currentModule.endsWith('Launcher'))
          document.getElementById('add').style.display = 'block'
        else
          document.getElementById('add').style.display = 'none'
        document.getElementById('line').style.opacity = '0.5'

        document.getElementById('logo').style.marginLeft = '20px'

        let json = getData()
        json.leftbar = true
        updateData(json)
      }
    })

    //MINI
    addButtonListener('mini', function() {
      document.getElementById('mini').style.backgroundColor = 'var(--buttonColor)';
    }, function() {
      document.getElementById('mini').style.backgroundColor = 'rgba(0, 0, 0, 0)';
    }, function() {
      ipcRenderer.send('mini');
    })

    //MAXI
    addButtonListener('maxi', function() {
      document.getElementById('maxi').style.backgroundColor = 'var(--buttonColor)';
    }, function() {
      document.getElementById('maxi').style.backgroundColor = 'rgba(0, 0, 0, 0)';
    }, function() {
      ipcRenderer.send('maxi');
    })

    //EXIT
    addButtonListener('exit', function() {
      document.getElementById('exit').style.backgroundColor = 'var(--buttonColor)';
    }, function() {
      document.getElementById('exit').style.backgroundColor = 'rgba(0, 0, 0, 0)';
    }, function() {
      ipcRenderer.send('exit')
    })

    //ADDFOLDER
    addButtonListener('addfolder', function() {
      document.getElementById('addfolder').style.backgroundImage = 'url("./Data/Images/icon_description_launch_clicked.png")';
    }, function() {
      document.getElementById('addfolder').style.backgroundImage = 'url("./Data/Images/icon_description_launch.png")';
    }, function() {
      window.scrollTo(0, 0);
      ipcRenderer.send('pause')
      ipcRenderer.send('addfolder')
    })

    //ADDGAME
    addButtonListener('addgame', function() {
      document.getElementById('addgame').style.backgroundImage = 'url("./Data/Images/icon_description_launch_clicked.png")';
    }, function() {
      document.getElementById('addgame').style.backgroundImage = 'url("./Data/Images/icon_description_launch.png")';
    }, function() {
      window.scrollTo(0, 0);
      ipcRenderer.send('pause')
      ipcRenderer.send('addgame')
    })
  }


  //MODULE FUNCTIONS
  function updateModules() {
    var children = document.getElementById('moduleButtons').childNodes;
    children.forEach(function(item){
      let id = item.id
      let path = document.getElementById('path-'+id).innerHTML
      addButtonListener(id, function() {
        document.getElementById(id).style.backgroundImage = 'url("./Data/Images/icon_description_launch_clicked.png")';
      }, function() {
        document.getElementById(id).style.backgroundImage = 'url("./Data/Images/icon_description_launch.png")';
      }, function() {
        loadModule(path)
      })

      if (path.endsWith('Modules\\Launcher') && currentModule == '' && children.length > 0)
        item.click()
        //document.getElementById('moduleButtons').firstChild.click()
    })
  }

  function loadModule(path, specialData) {
    if (loading) return
    if (!path.endsWith('\\')) path = path+'\\'
    let html = path+'main.html'
    if (!fs.existsSync(html)) return
    if (currentModule == path) return
    else currentModule = path

    setbuttons()
    ipcRenderer.removeAllListeners()

    loading = true
    $("#window").fadeOut(200)
    setTimeout(function() {
      document.getElementById('add').style.display = 'none'
      document.getElementById('window').scrollTop = 0
      $("#window").load(html.replaceAll(' ', '%20'), function () {
        $("#window").fadeIn(200)
        ipcRenderer.send('loaded', path)
        ipcRenderer.send('specialData', specialData)
        updateModules()
        a()
        setTimeout(function() {loading = false}, 200);
      })
    }, 200);
  }


  //DATA FUNCTIONS
  function getData() {
    let jsonPath = data.data+'settings.json'
    let rawdata = fs.readFileSync(jsonPath)
    return JSON.parse(rawdata)
  }

  function updateData(json) {
    fs.writeFileSync(data.data+'settings.json', JSON.stringify(json));
  }


  //NOTI
  function addNoti(name, title) {
    notis.push(name)
    if (title == undefined) title = 'Launching:'
    notisTitle.push(title)
    if (!showingNoti) notiAdmin()
  }

  function notiAdmin() {
    n1()

    function n1() { 
      if (notis.length > 0) {
        showingNoti = true
        n2()
      } else showingNoti = false
    }

    function n2() { 
      let name = notis[0]
      let title = notisTitle[0]
      notis.shift()
      notisTitle.shift()

      document.getElementById('notiName').innerText = name
      document.getElementById('notiTitle').innerText = title
      $( "#noti" ).fadeTo( "fast" , 1, function() {
        setTimeout(function() {
          $( "#noti" ).fadeTo( "fast" , 0)
        }, 1500)
      })
      
      setTimeout(function() {
        n1()
      }, 2500)
    }
  }


  //BUTTON LISTENERS
  function addButtonListener(id, mousedown, mouseup, click) {
    $('#'+id).bind('mousedown', function() {
      if (event.which != 1) return
      mousedown()
    })

    $(window).bind('mouseup', function() {
      if (event.which != 1) return
      mouseup()
    })

    $('#'+id).bind('click', function() {
      if (event.which != 1) return
      click()
    })
  }

  let rightId = ''
  function addRightButtonListener(id, mousedown, mouseup, click) {
    $('#'+id).bind('mousedown', function() {
      if (event.which != 3) return
      rightId = id
      mousedown()
    })

    $(window).bind('mouseup', function() {
      if (event.which != 3) return
      mouseup()
      setTimeout(() => { rightId = '' }, 50);
    })

    $('#'+id).bind('contextmenu', function() {
      if (event.which != 3) return
      if (rightId == id) {
        click()
      }
    })
  }
</script>
</html>